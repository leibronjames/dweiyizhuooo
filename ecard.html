<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>I MISS YOU XXL</title>
<style>
  :root{
    --bg1:#f7fbff; --bg2:#fff6f8; --accent:#7dd3fc; --card:#ffffff;
    --muted:#6b7280; --round:12px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter, "Segoe UI", system-ui, -apple-system, Roboto, Helvetica, Arial;
    background: linear-gradient(180deg,var(--bg1),var(--bg2));
    display:flex; align-items:center; justify-content:center; padding:18px;
  }

  .app {
    width:100%; max-width:720px; background:var(--card);
    border-radius:16px; box-shadow:0 10px 30px rgba(2,6,23,0.08);
    overflow:hidden;
  }

  header{
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 18px; gap:12px;
    border-bottom:1px solid #f1f5f9;
  }
  .logo {display:flex; align-items:center; gap:12px}
  .logo img{width:44px;height:44px;border-radius:10px; object-fit:cover}
  h1{margin:0;font-size:18px}
  .sub{font-size:13px;color:var(--muted);margin-top:2px}

  .main {padding:20px; display:flex; flex-direction:column; gap:14px;}
  .topbar {display:flex; justify-content:space-between; align-items:center; gap:12px;}
  .score {font-weight:800; color:#0f172a}
  .lives {font-weight:700;color:#0f172a}

  .panel {
    border-radius:12px; padding:18px; background:linear-gradient(180deg,#fff,#fffaf0);
    box-shadow:0 6px 18px rgba(2,6,23,0.04);
  }

  .boxes { width:100%; display:grid; gap:18px; justify-items:center; align-items:start; padding:6px; }
  .box {
    width:120px; height:120px; border-radius:14px; background:#fff4f6;
    box-shadow:0 8px 18px rgba(2,6,23,0.06); position:relative; overflow:visible; cursor:pointer;
    display:flex; align-items:flex-end; justify-content:center; touch-action: manipulation;
    transition: transform .12s;
  }
  .box:active { transform: translateY(4px) }
  .lid {
    position:absolute; top:10px; left:6%; width:88%; height:56%; border-radius:10px;
    background: linear-gradient(180deg,#ffdfe6,#ffd6e8); transform-origin:center top;
    box-shadow: 0 8px 18px rgba(2,6,23,0.06); transition: transform .32s cubic-bezier(.22,.9,.28,1);
    display:flex; align-items:center; justify-content:center; pointer-events:none;
  }
  .lid.open { transform: translateY(-36px) rotateX(10deg) scale(1.02); }
  .catwrap { position:absolute; bottom:8px; transform: translateY(36px) scale(.8); opacity:0; transition: all .36s cubic-bezier(.22,.9,.28,1); }
  .catwrap.show { transform: translateY(6px) scale(1); opacity:1; }

  .meow-bubble {
    position:absolute; top:-24px; left:50%; transform:translateX(-50%) translateY(0) scale(.8);
    background:#fff; border-radius:999px; padding:6px 10px; font-weight:800; box-shadow:0 6px 12px rgba(2,6,23,0.06);
    opacity:0; transition: all .26s;
  }
  .meow-bubble.show { transform:translateX(-50%) translateY(-18px) scale(1); opacity:1; }

  .controls { display:flex; gap:8px; align-items:center; margin-top:12px; justify-content:flex-end; }
  .btn {
    padding:10px 14px; border-radius:12px; border:0; cursor:pointer; font-weight:800;
    background: linear-gradient(90deg,var(--accent),#ffd6e0); color:#042742;
  }

  .yarn {
    position:fixed;
    width:30px; height:30px; border-radius:50%;
    display:grid; place-items:center; z-index:9999; pointer-events:none;
    transform: translate(-50%,-50%) scale(1);
    transition: transform .12s linear;
    will-change: left, top, transform;
  }

  @media (max-width:520px){
    .box { width:92px; height:92px }
    .logo img{width:40px;height:40px}
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Hide and Meow">
    <header>
      <div class="logo">
        <img src="cat_normal.jpg" alt="cat" id="logoImg">
        <div><h1>Hide & Meow</h1></div>
      </div>

      <div style="text-align:right">
        <div class="score" id="scoreDisplay">Score: 0</div>
        <div class="lives" id="livesDisplay">Lives: ❤❤❤</div>
      </div>
    </header>

    <div class="main">
      <div class="panel">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
          <div class="small" id="infoLine"></div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="restartBtn">Restart</button>
          </div>
        </div>

        <div id="boxesWrap" class="boxes" style="margin-top:18px;"></div>

        <div class="controls">
          <button class="btn" id="nextBtn" style="display:none;background:#c7f9f7">Next</button>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const boxesWrap = document.getElementById('boxesWrap');
  const restartBtn = document.getElementById('restartBtn');
  const nextBtn = document.getElementById('nextBtn');
  const scoreDisplay = document.getElementById('scoreDisplay');
  const livesDisplay = document.getElementById('livesDisplay');

  let score = 0;
  let lives = 3;
  const totalBoxes = 3;
  let correctIndex = -1;
  let busy = false;
  let autoAdvanceTimer = null;

  function updateScore(){ scoreDisplay.textContent = 'Score: ' + score; }
  function updateLives(){
    const heart = '❤';
    const out = heart.repeat(Math.max(0,lives));
    const lost = 3 - Math.max(0,lives);
    let s = out;
    for(let i=0;i<lost;i++) s += '♡';
    livesDisplay.textContent = 'Lives: ' + s;
  }

  function renderBoxes(){
    boxesWrap.innerHTML = '';
    const cols = totalBoxes <= 3 ? totalBoxes : Math.ceil(totalBoxes/2);
    boxesWrap.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    for(let i=0;i<totalBoxes;i++){
      const box = document.createElement('div');
      box.className = 'box';
      box.dataset.index = i;

      const lid = document.createElement('div'); lid.className = 'lid';
      box.appendChild(lid);

      const catWrap = document.createElement('div'); catWrap.className = 'catwrap';
      const img = document.createElement('img'); img.src='cat_normal.jpg'; img.alt='cat';
      img.style.width = '84px'; img.style.height = '84px'; img.style.borderRadius = '8px'; img.style.objectFit='cover';
      catWrap.appendChild(img);
      box.appendChild(catWrap);

      const bubble = document.createElement('div'); bubble.className = 'meow-bubble'; bubble.textContent='Meow! ✨';
      box.appendChild(bubble);

      box.addEventListener('click', ()=> onBoxTap(i, box));
      box.addEventListener('touchstart', (e)=> { e.preventDefault(); onBoxTap(i, box); }, {passive:false});

      boxesWrap.appendChild(box);
    }
  }

  function pickHide(){
    correctIndex = Math.floor(Math.random() * totalBoxes);
    document.querySelectorAll('.lid').forEach(l=> l.classList.remove('open'));
    document.querySelectorAll('.catwrap').forEach(c=> c.classList.remove('show'));
    document.querySelectorAll('.meow-bubble').forEach(b=> b.classList.remove('show'));
    nextBtn.style.display = 'none';
    busy = false;
  }

  function createYarn() {
    const el = document.createElement('div');
    el.className = 'yarn';
    el.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24"><path fill="#f472b6" d="M12 2c3.9 0 7 3.1 7 7 0 3.9-3.1 7-7 7S5 12.9 5 9c0-3.9 3.1-7 7-7z"/></svg>';
    document.body.appendChild(el);
    return el;
  }

  function animateYarn(el, sx, sy, tx, ty, ms=420){
    return new Promise(resolve => {
      let start = null;
      const startX = sx, startY = sy;
      const dx = tx - sx, dy = ty - sy;
      function step(ts){
        if(!start) start = ts;
        const elapsed = ts - start;
        const t = Math.min(1, elapsed / ms);
        const ease = 1 - (1 - t) * (1 - t);
        const curX = startX + dx * ease;
        const curY = startY + dy * ease - (Math.sin(ease * Math.PI) * 30);
        el.style.left = curX + 'px';
        el.style.top = curY + 'px';
        requestAnimationFrame(elapsed < ms ? step : (() => { setTimeout(resolve, 0); }));
      }
      requestAnimationFrame(step);
    });
  }

  async function onBoxTap(index, boxEl){
    if(busy) return;
    busy = true;

    const startX = window.innerWidth / 2;
    const startY = window.innerHeight - 120;
    const rect = boxEl.getBoundingClientRect();
    const targetX = rect.left + rect.width / 2;
    const targetY = rect.top + rect.height / 2;

    const yarn = createYarn();
    yarn.style.left = startX + 'px';
    yarn.style.top = startY + 'px';
    await animateYarn(yarn, startX, startY, targetX, targetY, 420);

    const lid = boxEl.querySelector('.lid');
    const catWrap = boxEl.querySelector('.catwrap');
    const bubble = boxEl.querySelector('.meow-bubble');

    if(index === correctIndex){
      lid.classList.add('open');
      catWrap.classList.add('show');
      bubble.classList.add('show');
      score++;
      updateScore();
      nextBtn.style.display = '';
      autoAdvanceTimer = setTimeout(()=> {
        document.querySelectorAll('.lid').forEach(l=> l.classList.remove('open'));
        document.querySelectorAll('.catwrap').forEach(c=> c.classList.remove('show'));
        document.querySelectorAll('.meow-bubble').forEach(b=> b.classList.remove('show'));
        pickHide();
      }, 900);
      yarn.remove();
      busy = false;
    } else {
      lid.classList.add('open');
      boxEl.animate([{transform:'translateX(0)'},{transform:'translateX(-8px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}], {duration:500, easing:'ease-in-out'});
      bubble.textContent = 'Nope';
      bubble.classList.add('show');
      lives--;
      updateLives();
      await new Promise(r => setTimeout(r, 700));
      lid.classList.remove('open');
      bubble.classList.remove('show');
      bubble.textContent = 'Meow! ✨';
      yarn.remove();

      if(lives <= 0){
        resetGame(); // silently restart
      } else busy = false;
    }
  }

  nextBtn.addEventListener('click', ()=> {
    if(autoAdvanceTimer) clearTimeout(autoAdvanceTimer);
    document.querySelectorAll('.lid').forEach(l=> l.classList.remove('open'));
    document.querySelectorAll('.catwrap').forEach(c=> c.classList.remove('show'));
    document.querySelectorAll('.meow-bubble').forEach(b=> b.classList.remove('show'));
    pickHide();
  });

  function resetGame(){
    if(autoAdvanceTimer) { clearTimeout(autoAdvanceTimer); autoAdvanceTimer = null; }
    score = 0; lives = 3;
    updateScore(); updateLives();
    renderBoxes();
    pickHide();
    busy = false;
  }
  restartBtn.addEventListener('click', ()=> resetGame());

  function init(){
    renderBoxes();
    pickHide();
    updateScore();
    updateLives();
  }

  init();

  document.addEventListener('keydown', (e)=> {
    if(e.key >= '1' && e.key <= '3'){
      const idx = parseInt(e.key,10)-1;
      const box = document.querySelector(`.box[data-index="${idx}"]`);
      if(box) box.click();
    }
  });
})();
</script>
</body>
</html>

